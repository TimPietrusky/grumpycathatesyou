(function(){window.App={Models:{},Collections:{},Views:{},Router:{}};window.template=function(e){return _.template($("#"+e).html())};window.vent=_.extend({},Backbone.Events);App.Router=Backbone.Router.extend({routes:{":img/:font/*title":"show","*index":"index"},initialize:function(){vent.bind("meme:save",this.save,this)},index:function(){vent.trigger("router:index",a.model)},show:function(f,e,g){g=decodeURIComponent(g);vent.trigger("meme:update",{img:f,font:e,title:g})},save:function(e){this.navigate(e.get("img")+"/"+e.get("font")+"/"+e.get("title"))}});App.Models.Meme=Backbone.Model.extend({defaults:{img:"1",font:"1",title:"Grumpy Cat Hates You.com"},validate:function(f,e){if(f.img<=0||f.img>6||f.img==undefined){return"not valid"}if(f.font<=0||f.font>5||f.font==undefined){return"not valid"}if(f.title==undefined){return"not valid"}}});App.Models.PictureEditor=Backbone.Model.extend({});App.Models.PictureEditor.Picture=Backbone.Model.extend({});App.Models.FontEditor=Backbone.Model.extend({});App.Models.FontEditor.Font=Backbone.Model.extend({});App.Collections.PictureEditor=Backbone.Collection.extend({model:App.Models.PictureEditor.Picture});App.Collections.FontEditor=Backbone.Collection.extend({model:App.Models.FontEditor.Font});App.Views.Meme=Backbone.View.extend({el:".meme",childs:{picture:null,title:null},initialize:function(){this.model.on("change",this.render,this);vent.bind("meme:update",this.update,this);vent.bind("save:click",this.save,this);vent.bind("router:index",this.render,this);this.childs.picture=new App.Views.Meme.Picture();this.childs.title=new App.Views.Meme.Title()},update:function(e){this.model.set({img:e.img,validate:true});this.model.set({font:e.font,validate:true});this.model.set("title",e.title)},save:function(){vent.trigger("meme:save",this.model);c.trigger({text:"Saved!",timeout:500})},render:function(){this.childs.picture.render(this.model);this.childs.title.render(this.model)},active:function(e){e?this.$el.addClass("active"):this.$el.removeClass("active")}});App.Views.Meme.Picture=Backbone.View.extend({el:".picture",render:function(e){this.$el.attr("src","/img/grumpycats/"+e.get("img")+".jpg")}});App.Views.Meme.Title=Backbone.View.extend({el:".title",render:function(e){this.$el.removeClass("size--alpha size--beta");var f=e.get("title");if(f.length>15&&f.length<=40){this.$el.addClass("size--alpha")}if(f.length>40){this.$el.addClass("size--beta")}this.$el.text(e.get("title"));this.$el.attr("data-font",e.get("font"))}});App.Views.Edit=Backbone.View.extend({el:"button.edit",mode:"edit",body:$("body"),events:{click:"click"},click:function(){switch(this.mode){case"edit":this.edit();break;case"save":this.save();break}},edit:function(){vent.trigger("edit:click");this.$el.text("Save");this.$el.addClass("save");this.mode="save";a.active(true);this.body.removeClass("saved")},save:function(){vent.trigger("save:click");this.$el.text("Edit");this.$el.removeClass("save");this.mode="edit";a.active(false);this.body.addClass("saved")}});App.Views.Editor=Backbone.View.extend({el:".editor",template:template("template_editor"),initialize:function(){vent.bind("edit:click",this.start,this);vent.bind("save:click",this.stop,this)},start:function(){this.$el.html(this.template);var h=new App.Views.TitleEditor();this.$el.find(".editor--title").append(h.render().el);var f=new App.Collections.PictureEditor([{img:1},{img:2},{img:3},{img:4},{img:5},{img:6},]);var i=new App.Views.PictureEditor({collection:f});this.$el.find(".editor--picture").append(i.render().el);var g=new App.Collections.FontEditor([{font:1,text:"Nosifer"},{font:2,text:"Alfa Slab One"},{font:3,text:"Peralta"},{font:4,text:"Princess Sofia"},{font:5,text:"Josefin Sans"},]);var e=new App.Views.FontEditor({collection:g});this.$el.find(".editor--font").append(e.render().el);this.$el.addClass("active")},stop:function(){this.$el.removeClass("active");setTimeout(_.bind(function(){this.$el.html("")},this),250)}});App.Views.TitleEditor=Backbone.View.extend({tagName:"textarea",events:{keyup:"keydown"},render:function(){this.$el.attr("spellcheck",false);this.$el.val(a.childs.title.$el.text());return this},keydown:function(){vent.trigger("meme:update",{title:this.$el.val()})}});App.Views.PictureEditor=Backbone.View.extend({tagName:"ul",initialize:function(){vent.bind("pictureeditor:update",this.update,this)},render:function(){this.collection.each(this.addOne,this);return this},addOne:function(f){var e=new App.Views.PictureEditor.Picture({model:f});this.$el.append(e.render().el)},update:function(){this.$el.find(".active").removeClass("active")}});App.Views.PictureEditor.Picture=Backbone.View.extend({tagName:"li",template:template("template_pictureEditor_picture"),events:{click:"click"},render:function(){var e=this.template(this.model.toJSON());this.$el.html(e);if(a.model.get("img")==this.model.get("img")){this.$el.addClass("active")}return this},click:function(){vent.trigger("pictureeditor:update");vent.trigger("meme:update",{img:this.model.get("img")});this.$el.addClass("active")}});App.Views.FontEditor=Backbone.View.extend({tagName:"ul",initialize:function(){vent.bind("fonteditor:update",this.update,this)},render:function(){this.collection.each(this.addOne,this);return this},addOne:function(f){var e=new App.Views.FontEditor.Font({model:f});this.$el.append(e.render().el)},update:function(){this.$el.find(".active").removeClass("active")}});App.Views.FontEditor.Font=Backbone.View.extend({tagName:"li",template:template("template_fontEditor_font"),events:{click:"click"},render:function(){var e=this.template(this.model.toJSON());this.$el.html(e);this.$el.attr("data-font",this.model.get("font"));if(a.model.get("font")==this.model.get("font")){this.$el.addClass("active")}return this},click:function(){vent.trigger("fonteditor:update");vent.trigger("meme:update",{font:this.model.get("font")});this.$el.addClass("active")}});App.Views.Share=Backbone.View.extend({el:'[data-type="1"]',events:{click:"click"},click:function(){c.trigger({text:"Copy the URL of your browser!",timeout:"1750"})}});App.Views.Tweet=Backbone.View.extend({el:'[data-type="2"]',initialize:function(){vent.bind("meme:update",this.update,this);vent.bind("router:index",this.update,this)},update:function(e){var f=e.title!=undefined?e.title:e.get("title");if(f!=undefined){f=f.replace(/\s/g,"+")}this.$el.attr("href",'http://twitter.com/share?url=&text=GrumpyCatHatesYou.com+says:+"'+f+'"')}});App.Views.Message=Backbone.View.extend({el:".message",timeoutID:-1,trigger:function(e){this.$el.html(e.text);this.$el.addClass("active");if(this.timeoutID!=-1){clearTimeout(this.timeoutID)}this.timeoutID=setTimeout(_.bind(function(){this.$el.removeClass("active");this.$el.html("")},this),e.timeout)}});var a=new App.Views.Meme({model:new App.Models.Meme()});var c=new App.Views.Message();new App.Views.Edit();var d=new App.Views.Tweet();var b=new App.Views.Share();new App.Views.Editor();new App.Router();Backbone.history.start({pushState:true,root:"/"})})();