(function(){window.App={Models:{},Collections:{},Views:{},Router:{}};window.template=function(b){return _.template($("#"+b).html())};window.vent=_.extend({},Backbone.Events);App.Router=Backbone.Router.extend({routes:{":img/:font/*title":"show","*index":"index"},initialize:function(){vent.bind("meme:save",this.save,this)},index:function(){vent.trigger("router:index")},show:function(c,b,d){d=decodeURIComponent(d);vent.trigger("meme:update",{img:c,font:b,title:d})},save:function(b){this.navigate(b.get("img")+"/"+b.get("font")+"/"+b.get("title"))}});App.Models.Meme=Backbone.Model.extend({defaults:{img:"1",font:"1",title:"GrumpyCatHatesYou.com"},validate:function(c,b){if(c.img<=0||c.img>6||c.img==undefined){return"not valid"}if(c.font<=0||c.font>5||c.font==undefined){return"not valid"}if(c.title==undefined){return"not valid"}}});App.Models.PictureEditor=Backbone.Model.extend({});App.Models.PictureEditor.Picture=Backbone.Model.extend({});App.Models.FontEditor=Backbone.Model.extend({});App.Models.FontEditor.Font=Backbone.Model.extend({});App.Collections.PictureEditor=Backbone.Collection.extend({model:App.Models.PictureEditor.Picture});App.Collections.FontEditor=Backbone.Collection.extend({model:App.Models.FontEditor.Font});App.Views.Meme=Backbone.View.extend({el:".meme",childs:{picture:null,title:null},initialize:function(){this.model.on("change",this.render,this);vent.bind("meme:update",this.update,this);vent.bind("save:click",this.save,this);vent.bind("router:index",this.render,this);this.childs.picture=new App.Views.Meme.Picture();this.childs.title=new App.Views.Meme.Title()},update:function(b){this.model.set({img:b.img,validate:true});this.model.set({font:b.font,validate:true});this.model.set("title",b.title)},save:function(){vent.trigger("meme:save",this.model)},render:function(){this.childs.picture.render(this.model);this.childs.title.render(this.model)}});App.Views.Meme.Picture=Backbone.View.extend({el:".picture",render:function(b){this.$el.attr("src","/img/grumpycats/"+b.get("img")+".jpg")}});App.Views.Meme.Title=Backbone.View.extend({el:".title",render:function(b){this.$el.removeClass("size--alpha size--beta");var c=b.get("title");if(c.length>15&&c.length<=40){this.$el.addClass("size--alpha")}if(c.length>40){this.$el.addClass("size--beta")}this.$el.text(b.get("title"));this.$el.attr("data-font",b.get("font"))}});App.Views.Edit=Backbone.View.extend({el:"button.edit",mode:"edit",body:$("body"),events:{click:"click"},click:function(){switch(this.mode){case"edit":this.edit();break;case"save":this.save();break}},edit:function(){vent.trigger("edit:click");this.$el.text("Save");this.$el.addClass("save");this.mode="save";this.body.removeClass("saved")},save:function(){vent.trigger("save:click");this.$el.text("Edit");this.$el.removeClass("save");this.mode="edit";this.body.addClass("saved")}});App.Views.Editor=Backbone.View.extend({el:".editor",template:template("template_editor"),initialize:function(){vent.bind("edit:click",this.start,this);vent.bind("save:click",this.stop,this)},start:function(){this.$el.html(this.template);var e=new App.Views.TitleEditor();this.$el.find(".editor--title").append(e.render().el);var c=new App.Collections.PictureEditor([{img:1},{img:2},{img:3},{img:4},{img:5},{img:6},]);var f=new App.Views.PictureEditor({collection:c});this.$el.find(".editor--picture").append(f.render().el);var d=new App.Collections.FontEditor([{font:1,text:"Nosifer"},{font:2,text:"Alfa Slab One"},{font:3,text:"Peralta"},{font:4,text:"Princess Sofia"},{font:5,text:"Josefin Sans"},]);var b=new App.Views.FontEditor({collection:d});this.$el.find(".editor--font").append(b.render().el);this.$el.addClass("active")},stop:function(){this.$el.removeClass("active");setTimeout(_.bind(function(){this.$el.html("")},this),250)}});App.Views.TitleEditor=Backbone.View.extend({tagName:"textarea",events:{keyup:"keydown"},render:function(){this.$el.attr("spellcheck",false);this.$el.val(a.childs.title.$el.text());return this},keydown:function(){vent.trigger("meme:update",{title:this.$el.val()})}});App.Views.PictureEditor=Backbone.View.extend({tagName:"ul",initialize:function(){vent.bind("pictureeditor:update",this.update,this)},render:function(){this.collection.each(this.addOne,this);return this},addOne:function(c){var b=new App.Views.PictureEditor.Picture({model:c});this.$el.append(b.render().el)},update:function(){this.$el.find(".active").removeClass("active")}});App.Views.PictureEditor.Picture=Backbone.View.extend({tagName:"li",template:template("template_pictureEditor_picture"),events:{click:"click"},render:function(){var b=this.template(this.model.toJSON());this.$el.html(b);if(a.model.get("img")==this.model.get("img")){this.$el.addClass("active")}return this},click:function(){vent.trigger("pictureeditor:update");vent.trigger("meme:update",{img:this.model.get("img")});this.$el.addClass("active")}});App.Views.FontEditor=Backbone.View.extend({tagName:"ul",initialize:function(){vent.bind("fonteditor:update",this.update,this)},render:function(){this.collection.each(this.addOne,this);return this},addOne:function(c){var b=new App.Views.FontEditor.Font({model:c});this.$el.append(b.render().el)},update:function(){this.$el.find(".active").removeClass("active")}});App.Views.FontEditor.Font=Backbone.View.extend({tagName:"li",template:template("template_fontEditor_font"),events:{click:"click"},render:function(){var b=this.template(this.model.toJSON());this.$el.html(b);this.$el.attr("data-font",this.model.get("font"));if(a.model.get("font")==this.model.get("font")){this.$el.addClass("active")}return this},click:function(){vent.trigger("fonteditor:update");vent.trigger("meme:update",{font:this.model.get("font")});this.$el.addClass("active")}});var a=new App.Views.Meme({model:new App.Models.Meme()});new App.Views.Edit();new App.Views.Editor();new App.Router();Backbone.history.start({pushState:true,root:"/"})})();